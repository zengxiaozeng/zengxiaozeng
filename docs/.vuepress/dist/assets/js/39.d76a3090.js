(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{384:function(s,a,e){"use strict";e.r(a);var n=e(40),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h3",{attrs:{id:"jenkins自动打包部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jenkins自动打包部署"}},[s._v("#")]),s._v(" Jenkins自动打包部署")]),s._v(" "),e("h3",{attrs:{id:"准备工作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),e("p",[s._v("熟悉"),e("code",[s._v("linux")]),e("a",{attrs:{href:"https://blog.csdn.net/tianzongnihao/article/details/80539264",target:"_blank",rel:"noopener noreferrer"}},[s._v("基本操作命令"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("常用的命令得熟记，比如拷贝文件夹命令，删除文件命令，获取超级管理员权限命令，给文件夹设置权限命令，vi编辑、修改、保存命令...")]),s._v(" "),e("h3",{attrs:{id:"jumpserver部署介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jumpserver部署介绍"}},[s._v("#")]),s._v(" JumpServer部署介绍")]),s._v(" "),e("p",[s._v("在"),e("code",[s._v("jenkins")]),s._v("自动部署之前，先介绍一个手动的部署方式，对比"),e("code",[s._v("jenkins")]),s._v("配置，可以少很多的配置工作，直接打包拖拽到"),e("code",[s._v("JumpServer")]),s._v("对应的服务器上，优点就是快捷，少配置，只要熟悉基本文件的拷贝和删除命令就够用了，非常的灵活。缺点吗就是太灵活了，太灵活的东西如果不加以条条框框的限制，就容易出错。")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("Web终端")])])]),s._v(" "),e("blockquote",[e("p",[s._v("cp -r dir1 dir2 // dir1: 源目录  dir2: 目标目录")])]),s._v(" "),e("p",[s._v("本文我们的目标目录是在"),e("code",[s._v("/usr/local/nginx/webServer")]),s._v("，即所有的打包文件都存放在"),e("code",[s._v("/webServer")]),s._v("目录文件夹下")]),s._v(" "),e("p",[s._v("除了"),e("code",[s._v("conf")]),s._v("文件是存放配置的目录，其它的文件夹都一一对应各个项目的打包配置，这里我们就要把对应的"),e("code",[s._v("test文件")]),s._v("拷贝到这个目录文件夹下即可。这里加了"),e("code",[s._v("sudo")]),s._v("命令，是为了防止命令行警告无权限的警告提示")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /tmp\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" /usr/local/nginx/webServer\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("这样我们就把"),e("code",[s._v("test")]),s._v("顺利拷贝到目标文件目录下了。")]),s._v(" "),e("p",[s._v("接下来我们要做好"),e("code",[s._v("test")]),s._v("这个项目的配置文件，只是单单的把文件目录存放到"),e("code",[s._v("/webServer")]),s._v("是肯定不够的")]),s._v(" "),e("p",[s._v("如上图的"),e("code",[s._v("/conf")]),s._v("配置文件目录，进入到这一层级目录中，看到对应的所有的"),e("code",[s._v("/webServer")]),s._v("下面的项目的"),e("code",[s._v("conf")]),s._v("文件配置。先查看一下其中的文件配置")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" 项目名.conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"/zxz/images/projects/jenkins/1621394174390.jpg",alt:""}})]),s._v(" "),e("p",[s._v("详细的配置介绍如上图，这里我们要新建一个"),e("code",[s._v("test.conf")]),s._v("文件，要改动的点就是图中的"),e("code",[s._v("端口号")]),s._v("，站点根目录地址"),e("code",[s._v("/usr/local/nginx/webServer/test")]),s._v(","),e("code",[s._v("Nginx")]),s._v("服务端转发配置即可")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r 项目名.conf test.conf   // 拷贝项目名.conf到test.conf\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" test.conf // 进入test配置文件的编辑模式，修改配置文件信息\ni           // 进入编辑环境\nesc         // 修改完后退出编辑环境\n:wq         // 保存退出\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("这里我们要改的就是唯一的端口号设置和对应的目录地址，Nginx服务端地址转发配置可以参考图中格式修改即可。这里还有一项服务器地址名，"),e("code",[s._v("192.168.14.31")]),s._v("。这里跟之前的开发环境对应的目录名是一一对应的，所以我们不用管这个地方\n"),e("img",{attrs:{src:"/zxz/images/projects/jenkins/1621394652923.jpg",alt:""}})]),s._v(" "),e("p",[s._v("到这里所有的配置就配置完成了。可以试着用刚才的域名和端口好在浏览器直接访问下"),e("code",[s._v("http://192.168.14.31:9191")]),s._v(",结果当然是...无法访问啦")]),s._v(" "),e("p",[s._v("因为你修改了配置，服务器肯定要重启才行")]),s._v(" "),e("ul",[e("li",[s._v("重启服务器")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/nginx/sbin // Nginx服务器地址\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx // 查找Nginx地址\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./nginx -s reload  // Nginx服务器重启\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("重启命令后，这个时候再去访问刚才的域名就能够正确打开了，自此，手动配置服务器就完成了，是不是"),e("code",[s._v("so easy~")])]),s._v(" "),e("h3",{attrs:{id:"jenkins命令行配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jenkins命令行配置"}},[s._v("#")]),s._v(" jenkins命令行配置")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##打包后的项目名 注意=号前后不能有空格")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("web_name")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##打包后的项目地址")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("web_path")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx/webServer\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##目标服务器用户名和地址")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("web_address")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin@192.168.x.x\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##打包后的压缩项目名")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("web_zip")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##删除原有包")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${web_zip}")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##安装相关依赖模块")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##编译包")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##删除原来位置前端包")]),s._v("\nansible "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${web_address}")]),s._v(" -m shell -a "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rm -rf '")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${web_path}")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${web_name}")]),s._v("\nansible "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${web_address}")]),s._v(" -m shell -a "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rm -rf '")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${web_path}")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${web_zip}")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.zip'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##推送前端包到指定目录")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -r "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${web_zip}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${web_address}")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${web_path}")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##修改项目权限")]),s._v("\nansible "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${web_address}")]),s._v(" -m "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" -a "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'chmod -R 775 '")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${web_path}")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${web_name}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])]),e("p",[s._v("好了，然后就可以直接运行构建命令了。构建过程中如果有任何错误都会显示在控制台上，我们可以从项目配置首页栏目的"),e("code",[s._v("构建历史模块")]),s._v("进入查看构建进度。只有这一栏是蓝色的小标签就证明构建成功，灰色的代表构建中途取消，红色的代表构建失败。")]),s._v(" "),e("p",[s._v("失败的话可以点进去查看下失败的原因解释，再做出配置里面的对应调整")]),s._v(" "),e("p",[e("img",{attrs:{src:"/zxz/images/projects/jenkins/1621408819636.jpg",alt:""}})]),s._v(" "),e("p",[e("img",{attrs:{src:"/zxz/images/projects/jenkins/1621408863530.jpg",alt:""}})]),s._v(" "),e("p",[s._v("完毕，收工~快拿你的新项目练练手吧。")]),s._v(" "),e("h3",{attrs:{id:"最后"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#最后"}},[s._v("#")]),s._v(" 最后")]),s._v(" "),e("p",[s._v("自从学会了自动打包部署，新项目到了提测阶段后再也不用到处求人去部署环境，去修改配置服务端Nginx代理，自己动手，丰衣足食。")]),s._v(" "),e("p",[s._v("最后的最后，所有的git提测分支，都是要先提交之后再构建的。")])])}),[],!1,null,null,null);a.default=t.exports}}]);