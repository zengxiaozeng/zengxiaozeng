<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>小程序开发 | 曾小曾的前端小站</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/zxz/favicon.ico">
    <meta name="description" content=" ">
    <link rel="preload" href="/zxz/assets/css/0.styles.88aca36b.css" as="style"><link rel="preload" href="/zxz/assets/js/app.92503a3d.js" as="script"><link rel="preload" href="/zxz/assets/js/2.f08df1f8.js" as="script"><link rel="preload" href="/zxz/assets/js/41.1d1c5820.js" as="script"><link rel="prefetch" href="/zxz/assets/js/10.7a96103a.js"><link rel="prefetch" href="/zxz/assets/js/11.73c6b8eb.js"><link rel="prefetch" href="/zxz/assets/js/12.f12877c1.js"><link rel="prefetch" href="/zxz/assets/js/13.f067228c.js"><link rel="prefetch" href="/zxz/assets/js/14.7b206be0.js"><link rel="prefetch" href="/zxz/assets/js/15.b201925a.js"><link rel="prefetch" href="/zxz/assets/js/16.6d04c679.js"><link rel="prefetch" href="/zxz/assets/js/17.a9a15eaf.js"><link rel="prefetch" href="/zxz/assets/js/18.978623dd.js"><link rel="prefetch" href="/zxz/assets/js/19.93d33dda.js"><link rel="prefetch" href="/zxz/assets/js/20.5ead02f3.js"><link rel="prefetch" href="/zxz/assets/js/21.5e7348ab.js"><link rel="prefetch" href="/zxz/assets/js/22.10afa0aa.js"><link rel="prefetch" href="/zxz/assets/js/23.0e495dfc.js"><link rel="prefetch" href="/zxz/assets/js/24.dc34df21.js"><link rel="prefetch" href="/zxz/assets/js/25.a2eac0e5.js"><link rel="prefetch" href="/zxz/assets/js/26.1e4179bb.js"><link rel="prefetch" href="/zxz/assets/js/27.70c587c7.js"><link rel="prefetch" href="/zxz/assets/js/28.f1a10345.js"><link rel="prefetch" href="/zxz/assets/js/29.3b211a85.js"><link rel="prefetch" href="/zxz/assets/js/3.8507ebb1.js"><link rel="prefetch" href="/zxz/assets/js/30.634a8e99.js"><link rel="prefetch" href="/zxz/assets/js/31.0bc75df9.js"><link rel="prefetch" href="/zxz/assets/js/32.79fa5310.js"><link rel="prefetch" href="/zxz/assets/js/33.3e502a98.js"><link rel="prefetch" href="/zxz/assets/js/34.05af0d7c.js"><link rel="prefetch" href="/zxz/assets/js/35.30bba2bd.js"><link rel="prefetch" href="/zxz/assets/js/36.24cda84f.js"><link rel="prefetch" href="/zxz/assets/js/37.d6f2aa9d.js"><link rel="prefetch" href="/zxz/assets/js/38.23812e8a.js"><link rel="prefetch" href="/zxz/assets/js/39.d76a3090.js"><link rel="prefetch" href="/zxz/assets/js/4.78d9e583.js"><link rel="prefetch" href="/zxz/assets/js/40.ff3d577d.js"><link rel="prefetch" href="/zxz/assets/js/42.76c852b7.js"><link rel="prefetch" href="/zxz/assets/js/43.1b1b101a.js"><link rel="prefetch" href="/zxz/assets/js/44.dfaaad83.js"><link rel="prefetch" href="/zxz/assets/js/45.494d59fc.js"><link rel="prefetch" href="/zxz/assets/js/46.eeeec9d0.js"><link rel="prefetch" href="/zxz/assets/js/47.842028c9.js"><link rel="prefetch" href="/zxz/assets/js/48.efaff255.js"><link rel="prefetch" href="/zxz/assets/js/5.f1696d17.js"><link rel="prefetch" href="/zxz/assets/js/6.84a89b03.js"><link rel="prefetch" href="/zxz/assets/js/7.cb4465c4.js"><link rel="prefetch" href="/zxz/assets/js/8.35295575.js"><link rel="prefetch" href="/zxz/assets/js/9.6e22fe94.js">
    <link rel="stylesheet" href="/zxz/assets/css/0.styles.88aca36b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zxz/" class="home-link router-link-active"><!----> <span class="site-name">曾小曾的前端小站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zxz/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码规范" class="dropdown-title"><span class="title">代码规范</span> <span class="arrow down"></span></button> <button type="button" aria-label="代码规范" class="mobile-dropdown-title"><span class="title">代码规范</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zxz/code/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/es6/" class="nav-link">
  ECMAScript 6
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/experience/" class="nav-link">
  体验性
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="组件化" class="dropdown-title"><span class="title">组件化</span> <span class="arrow down"></span></button> <button type="button" aria-label="组件化" class="mobile-dropdown-title"><span class="title">组件化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zxz/components/directives/" class="nav-link">
  指令
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/filters/" class="nav-link">
  过滤器
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/utils/" class="nav-link">
  工具库
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/css/" class="nav-link">
  预处理语言
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/times/" class="nav-link">
  日期工具函数
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/skills/" class="nav-link">
  Vue开发技巧
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战" class="dropdown-title"><span class="title">实战</span> <span class="arrow down"></span></button> <button type="button" aria-label="实战" class="mobile-dropdown-title"><span class="title">实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zxz/projects/vue3.0/" class="nav-link">
  Vue 3.0
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/h5/" class="nav-link">
  H5支付
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/componentization/" class="nav-link">
  组件化分享
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/uniApp/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  微信小程序
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/unionpay/" class="nav-link">
  云闪付小程序
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/react/" class="nav-link">
  React+Redux-saga
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/vue2.0/" class="nav-link">
  Vue 2.0+Ts
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/jenkins/" class="nav-link">
  Jenkins自动部署
</a></li></ul></div></div><div class="nav-item"><a href="/zxz/tools/" class="nav-link">
  工具库
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zxz/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码规范" class="dropdown-title"><span class="title">代码规范</span> <span class="arrow down"></span></button> <button type="button" aria-label="代码规范" class="mobile-dropdown-title"><span class="title">代码规范</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zxz/code/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/es6/" class="nav-link">
  ECMAScript 6
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/experience/" class="nav-link">
  体验性
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="组件化" class="dropdown-title"><span class="title">组件化</span> <span class="arrow down"></span></button> <button type="button" aria-label="组件化" class="mobile-dropdown-title"><span class="title">组件化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zxz/components/directives/" class="nav-link">
  指令
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/filters/" class="nav-link">
  过滤器
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/utils/" class="nav-link">
  工具库
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/css/" class="nav-link">
  预处理语言
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/times/" class="nav-link">
  日期工具函数
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/skills/" class="nav-link">
  Vue开发技巧
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战" class="dropdown-title"><span class="title">实战</span> <span class="arrow down"></span></button> <button type="button" aria-label="实战" class="mobile-dropdown-title"><span class="title">实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zxz/projects/vue3.0/" class="nav-link">
  Vue 3.0
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/h5/" class="nav-link">
  H5支付
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/componentization/" class="nav-link">
  组件化分享
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/uniApp/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  微信小程序
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/unionpay/" class="nav-link">
  云闪付小程序
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/react/" class="nav-link">
  React+Redux-saga
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/vue2.0/" class="nav-link">
  Vue 2.0+Ts
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/jenkins/" class="nav-link">
  Jenkins自动部署
</a></li></ul></div></div><div class="nav-item"><a href="/zxz/tools/" class="nav-link">
  工具库
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zxz/projects/uniApp/" aria-current="page" class="active sidebar-link">小程序开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zxz/projects/uniApp/#一、注册" class="sidebar-link">一、注册</a></li><li class="sidebar-sub-header"><a href="/zxz/projects/uniApp/#二、登录设置" class="sidebar-link">二、登录设置</a></li><li class="sidebar-sub-header"><a href="/zxz/projects/uniApp/#三、选框架-安装开发工具" class="sidebar-link">三、选框架，安装开发工具</a></li><li class="sidebar-sub-header"><a href="/zxz/projects/uniApp/#四、项目开发" class="sidebar-link">四、项目开发</a></li><li class="sidebar-sub-header"><a href="/zxz/projects/uniApp/#五、正式项目开发" class="sidebar-link">五、正式项目开发</a></li><li class="sidebar-sub-header"><a href="/zxz/projects/uniApp/#六、静默授权" class="sidebar-link">六、静默授权</a></li><li class="sidebar-sub-header"><a href="/zxz/projects/uniApp/#七、功能扩展" class="sidebar-link">七、功能扩展</a></li><li class="sidebar-sub-header"><a href="/zxz/projects/uniApp/#八、开屏广告页" class="sidebar-link">八、开屏广告页</a></li><li class="sidebar-sub-header"><a href="/zxz/projects/uniApp/#九、消息推送" class="sidebar-link">九、消息推送</a></li><li class="sidebar-sub-header"><a href="/zxz/projects/uniApp/#十、发布测试" class="sidebar-link">十、发布测试</a></li><li class="sidebar-sub-header"><a href="/zxz/projects/uniApp/#十一、发布正式" class="sidebar-link">十一、发布正式</a></li><li class="sidebar-sub-header"><a href="/zxz/projects/uniApp/#十二、题外话" class="sidebar-link">十二、题外话</a></li><li class="sidebar-sub-header"><a href="/zxz/projects/uniApp/#十三、github源码" class="sidebar-link">十三、Github源码</a></li><li class="sidebar-sub-header"><a href="/zxz/projects/uniApp/#十四、基于react-redux-saga的实战项目" class="sidebar-link">十四、基于React+Redux-saga的实战项目</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="小程序开发"><a href="#小程序开发" class="header-anchor">#</a> 小程序开发</h3> <p>小程序的开发选型，推荐这篇文章<a href="https://juejin.im/post/6844903862504013832" target="_blank" rel="noopener noreferrer">小程序开发：用原生还是选框架<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>选型之类过多的话语就不说了，个人还是比较推荐uni-app，要么就原生。</p> <p>废话不多说，开干。</p> <h2 id="一、注册"><a href="#一、注册" class="header-anchor">#</a> 一、注册</h2> <p>网址： <a href="https://mp.weixin.qq.com" target="_blank" rel="noopener noreferrer">微信注册<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，根据指引填写信息</p> <p>PS：开发选型的时候一定要注意主体账号信息的分类，简单解释就是这个小程序是要干嘛的，定位要精准，小程序的上线目前越来越严格，并不是所有小程序都能过审的。比如，人脸授权这种功能，你就很难过审...如果有这个功能，我劝你放弃，走APP。</p> <h2 id="二、登录设置"><a href="#二、登录设置" class="header-anchor">#</a> 二、登录设置</h2> <p>登录后找到设置模块，在这里你可以设置一些小程序的主题信息，比较重要的就是这个<code>AppID(小程序ID)</code>，唯一的，相当于微信小程序的敲门砖</p> <p>当项目是多人协作的时候，你可以添加多个开发者账号</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/13/16e63478e842b9a1?w=2604&amp;h=1096&amp;f=png&amp;s=211485" alt=""></p> <h2 id="三、选框架-安装开发工具"><a href="#三、选框架-安装开发工具" class="header-anchor">#</a> 三、选框架，安装开发工具</h2> <p>这里用的是<code>uni-app</code>，当然<code>微信小程序</code>的<code>微信开发者工具</code>也是要安装的，微信开发者工具呢建议还是安装最新版的，原因当然是最新版的会不断加入很多新特性。<code>uni-app</code>的开发也必须安装<code>HBuilderX</code>工具，这个是捆绑的，没得选择。虽然有很多人吐槽这个<code>HBuilderX</code>，号称傻瓜式的编程工具。好吧，要用<code>uni-app</code>，你必须得<font color="red">装！！！</font></p> <p>工具安装：</p> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html" target="_blank" rel="noopener noreferrer">微信开发者工具<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://www.dcloud.io/hbuilderx.html" target="_blank" rel="noopener noreferrer">HBuilderX<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>至此，所有的准备工作都OK了，接下来直接进入项目开发了。</p> <h2 id="四、项目开发"><a href="#四、项目开发" class="header-anchor">#</a> 四、项目开发</h2> <p>1、新建一个<code>uni-app</code>项目
<img src="https://user-gold-cdn.xitu.io/2019/11/13/16e636c0f0355821?w=1082&amp;h=764&amp;f=png&amp;s=952864" alt=""></p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/13/16e638aa3f19e13a?w=1172&amp;h=636&amp;f=png&amp;s=88199" alt="">
2、项目结构</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/13/16e6393577d5fc21?w=198&amp;h=415&amp;f=png&amp;s=75145" alt=""></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>.
├─ common/              # 公用工具库文件
├─ components/          # uni-app组件目录
│  ├─ comp-a.vue        # 可复用的a组件
├─ hybrid/              # 存放本地网页的目录
├─ pages/               # 业务页面文件存放的目录
│  ├─ home/            
│  │  ├─ index.vue      # home页面
│  ├─ list/            
│  │  ├─ index.vue      # list页面
├─ platforms/           # 存放各平台专用页面的目录
├─ static               # 存放应用引用静态资源（如图片、视频等）的目录，注意：静态资源只能存放于此
├─ unpackage/           # 打包目录
├─ wxcomponents/        # 存放小程序组件的目录
├─ App.vue              #  应用配置，用来配置App全局样式以及监听
├─ main.js              # Vue初始化入口文件
├─ manifest.json        # 配置应用名称、appid、logo、版本等打包信息
├─ package.json         # 配置页面路由、导航条、选项卡等页面类信息
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>Tips:</p> <p><code>static</code> 目录下的 <code>js</code> 文件不会被编译，如果里面有 es6 的代码，不经过转换直接运行，在手机设备上会报错。</p> <p><code>css</code>、<code>less/scss</code> 等资源同样不要放在 static 目录下，建议这些公用的资源放在 <code>common</code> 目录下。</p> <p>3、项目运行
<img src="https://user-gold-cdn.xitu.io/2019/11/13/16e63a6536705aba?w=887&amp;h=285&amp;f=png&amp;s=230798" alt=""></p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/13/16e63a6c12cee7ed?w=1005&amp;h=688&amp;f=png&amp;s=493355" alt="">
第一次运行容易报图上的错，这个时候，可以手动打开<code>微信开发者工具</code>，<code>扫码登录(加入开发者账号)</code>。然后再重新运行到小程序，或者配置微信开发者工具的默认路劲，这样一劳永逸，就不用每次先开<code>微信小程序</code>再运行项目了。</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/13/16e63ac8009f6505?w=1272&amp;h=413&amp;f=png&amp;s=429688" alt="">
再运行的时候通常还是容易报错...不过别着急，一步一步来</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/13/16e63b27b5441ada?w=1255&amp;h=261&amp;f=png&amp;s=447199" alt=""></p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/13/16e63b29a1cb35c6?w=478&amp;h=425&amp;f=png&amp;s=141278" alt="">
再次重新运行小程序，终于可以编译成功了，图为demo模板的页面
[图片]
<img src="https://user-gold-cdn.xitu.io/2019/11/13/16e63b5da08549ff?w=413&amp;h=734&amp;f=png&amp;s=112576" alt="">
当然，至此只是让你先体验一下uni-app，接下来直接进入正式开发</p> <h2 id="五、正式项目开发"><a href="#五、正式项目开发" class="header-anchor">#</a> 五、正式项目开发</h2> <p>之前的模板内容太多了，项目重新开启前还是重新建一个空的模板吧，新建项目的时候依然选择uni-app项目+默认模板</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/15/16e6ce9a9394e2cf?w=198&amp;h=218&amp;f=png&amp;s=12850" alt=""></p> <p>1.配置AppID</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/15/16e6ceb12035082a?w=1218&amp;h=449&amp;f=png&amp;s=107626" alt=""></p> <p>2.运行项目</p> <p>为了方便开发，可以安装一个内置的终端，可以不用额外打开终端</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/15/16e6cee49b4301d3?w=195&amp;h=43&amp;f=png&amp;s=2694" alt=""></p> <p>3.搭建目录框架</p> <p>因为使用默认模板，所以项目结构很干净。接下来先把目录框架搞定，当然你也可以按照自己的个人习惯和喜好自由设置</p> <p>因为之前安装了内置终端，所以直接打开终端，会默认打开你所在的项目的根路径，直接在根路径下命令行创建目录文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir components models store utils
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://user-gold-cdn.xitu.io/2019/11/15/16e6cf54fb58d282?w=580&amp;h=379&amp;f=png&amp;s=33964" alt=""></p> <p>4.微信路由
准确的来说<code>uni-app</code>小程序也是单页面的形式。在小程序中，路由是不用自己定义的。<code>uni-app</code>路由全部交给框架统一管理，开发者需要在<code>pages.json</code>里配置每个路由页面的路径及页面样式，不支持 <code>Vue Router</code>，如图，<code>pages</code>属性值的数组内容即为路由路劲</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
    &quot;pages&quot;: [ //pages数组中第一项表示应用启动页，参考：https://uniapp.dcloud.io/collocation/pages
    	{
            &quot;path&quot;: &quot;pages/index/index&quot;,
            &quot;style&quot;: {
            	&quot;navigationBarTitleText&quot;: &quot;首页&quot;,
            	&quot;navigationBarBackgroundColor&quot;: &quot;#FFFFFF&quot;
            }
    	},
        {
            &quot;path&quot; : &quot;pages/mine/index&quot;,
            &quot;style&quot; : {
            	&quot;navigationBarTitleText&quot;: &quot;个人中心&quot;,
            	&quot;navigationBarBackgroundColor&quot;: &quot;#FFFFFF&quot;
            }
        }
    ],
    &quot;globalStyle&quot;: {
    	&quot;navigationBarTextStyle&quot;: &quot;black&quot;,
    	&quot;navigationBarTitleText&quot;: &quot;uni-app&quot;,
    	&quot;navigationBarBackgroundColor&quot;: &quot;#F8F8F8&quot;,
    	&quot;backgroundColor&quot;: &quot;#FFFFFF&quot;
    },
    &quot;tabBar&quot;: {
    	&quot;color&quot;: &quot;#BBBBBB&quot;,
    	&quot;selectedColor&quot;: &quot;#212121&quot;,
    	&quot;borderStyle&quot;: &quot;black&quot;,
    	&quot;backgroundColor&quot;: &quot;#ffffff&quot;,
    	&quot;list&quot;: [
            {
            	&quot;pagePath&quot;: &quot;pages/index/index&quot;,
            	&quot;iconPath&quot;: &quot;static/images/tabbar/fans.png&quot;,
            	&quot;selectedIconPath&quot;: &quot;static/images/tabbar/fans@selected.png&quot;,
            	&quot;text&quot;: &quot;首页&quot;
            },
            {
            	&quot;pagePath&quot;: &quot;pages/mine/index&quot;,
            	&quot;iconPath&quot;: &quot;static/images/tabbar/mine.png&quot;,
            	&quot;selectedIconPath&quot;: &quot;static/images/tabbar/mine@selected.png&quot;,
            	&quot;text&quot;: &quot;个人中心&quot;
            }
        ]
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>5.<code>vuex</code>状态管理</p> <p>首先，<code>uni-app</code> 内置了 <code>vuex</code>。但是<code>vuex</code>是不支持持久化存储的，所以需要结合第三方来一起协作。</p> <p>默认的模板项目首先是没有<code>node-modules</code>模块依赖的，也就是说你没法进行一些第三方的扩展，所以为了让你的项目更加的灵活性，你需要执行以下命令来搭配一些第三方来更随心所欲的开发项目</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm init -y
npm install vuex-persistedstate --save
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>store.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>

<span class="token keyword">import</span> home <span class="token keyword">from</span> <span class="token string">'@/store/modules/home.js'</span>
<span class="token keyword">import</span> mine <span class="token keyword">from</span> <span class="token string">'@/store/modules/mine.js'</span>
<span class="token keyword">import</span> createPersistedState <span class="token keyword">from</span> <span class="token string">'vuex-persistedstate'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token keyword">const</span> vuexPersisted <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">createPersistedState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    storage<span class="token operator">:</span> <span class="token punctuation">{</span>
    	<span class="token function-variable function">getItem</span><span class="token operator">:</span> <span class="token parameter">key</span> <span class="token operator">=&gt;</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function-variable function">setItem</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function-variable function">removeItem</span><span class="token operator">:</span> <span class="token parameter">key</span> <span class="token operator">=&gt;</span> uni<span class="token punctuation">.</span><span class="token function">clearStorageSync</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    modules<span class="token operator">:</span> <span class="token punctuation">{</span>
    	home<span class="token punctuation">,</span>
    	mine
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span>vuexPersisted<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p><code>home</code>里面的<code>vuex</code>结构也展示一下吧</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> home <span class="token operator">=</span> <span class="token punctuation">{</span>
    state<span class="token operator">:</span> <span class="token punctuation">{</span>
    	<span class="token operator">...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    mutations<span class="token operator">:</span> <span class="token punctuation">{</span>
    	<span class="token operator">...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    	<span class="token operator">...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    getters<span class="token operator">:</span> <span class="token punctuation">{</span>
    	<span class="token operator">...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> home
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>最后，在<code>main.js</code>里面引用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span>

Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$store <span class="token operator">=</span> store

App<span class="token punctuation">.</span>mpType <span class="token operator">=</span> <span class="token string">'app'</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    store<span class="token punctuation">,</span>
    <span class="token operator">...</span>App
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>至此，含两个<code>tabbr</code>选项的无数据交互的小程序ui结构就搭好了。</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/15/16e6db090d459b76?w=307&amp;h=552&amp;f=gif&amp;s=19909" alt=""></p> <p>6.封装<code>api模块</code></p> <p>因为需要调用服务端的登录口子，所以我们优先把请求接口的模块给添加进来吧。</p> <p><code>config</code>配置，<code>appId</code>和<code>appKey</code>可以从<a href="https://mp.weixin.qq.com/wxamp/devprofile/get_profile?token=624706352&amp;lang=zh_CN" target="_blank" rel="noopener noreferrer">微信官方<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>开发模块获取到</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/15/16e6de7573e9b0ab?w=1286&amp;h=613&amp;f=png&amp;s=79747" alt=""></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//uni-app内置有区别环境的不同，可以直接通过process.env.NODE_ENV获取</span>
<span class="token comment">//！！！注意，这里的接口当然是不能访问的，正式的api接口是商业保密的，后期抽时间用node来补上吧。项目无法正常接口请求，请谅解。但是跟着我的思路，把一个项目跑起来是没有任何问题的。</span>
<span class="token keyword">let</span> <span class="token constant">BASE_URL</span> <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">==</span> <span class="token string">'development'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">BASE_URL</span> <span class="token operator">=</span> <span class="token string">'192.168.1.1:8090'</span> <span class="token comment">// qe环境</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token constant">BASE_URL</span> <span class="token operator">=</span> <span class="token string">'https://www.baidu.com'</span> <span class="token comment">// 生产环境</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
	base_url<span class="token operator">:</span> <span class="token constant">BASE_URL</span><span class="token punctuation">,</span>
	appId<span class="token operator">:</span> <span class="token string">'wxeb407bb6c397aa4c'</span><span class="token punctuation">,</span>
	appKey<span class="token operator">:</span> <span class="token string">'675aeecfdac05b6b82b9910a8fd00e88'</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> config <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>封装接口请求</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
	config
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../config.js'</span>

<span class="token keyword">class</span> <span class="token class-name">HTTP</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>baseUrl <span class="token operator">=</span> config<span class="token punctuation">.</span>base_url
	<span class="token punctuation">}</span>

	<span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		url<span class="token punctuation">,</span>
		data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		method <span class="token operator">=</span> <span class="token string">'GET'</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_request</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">,</span> data<span class="token punctuation">,</span> method<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token function">_request</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">,</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">'GET'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		uni<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>baseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
			method<span class="token operator">:</span> method<span class="token punctuation">,</span>
			data<span class="token operator">:</span> data<span class="token punctuation">,</span>
			header<span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token string">'content-type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
				<span class="token string">'appId'</span><span class="token operator">:</span> config<span class="token punctuation">.</span>appId<span class="token punctuation">,</span>
				<span class="token string">'token'</span><span class="token operator">:</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'AuthTokens'</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">const</span> _success <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>success<span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>_success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
						<span class="token function">reject</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
						<span class="token keyword">const</span> error_code <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code<span class="token punctuation">;</span>
						<span class="token keyword">const</span> _message <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token punctuation">;</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_show_error</span><span class="token punctuation">(</span>error_code<span class="token punctuation">,</span> _message<span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					<span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_show_error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token function">_show_error</span><span class="token punctuation">(</span><span class="token parameter">error_code<span class="token punctuation">,</span> _message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			title<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
			icon<span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
			duration<span class="token operator">:</span> <span class="token number">2000</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span>
    <span class="token constant">HTTP</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><p>到此Api请求的模块就封装好了，现在开始做接口请求必须携带的<code>AuthTokens</code>秘钥</p> <p>因为小程序肯定会频繁的切换后台或者直接切回首页面，结合小程序的生命周期等，在首页的主入口一般都会调一次登录口子，获取秘钥<code>token</code></p> <p><code>App.vue</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> AppModel <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./models/app.js'</span>
<span class="token keyword">const</span> appModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AppModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function-variable function">onShow</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'on show'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">getLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        uni<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    appModel<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        code<span class="token operator">:</span> res<span class="token punctuation">.</span>code
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'setUserInfo'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
                        <span class="token comment">//这里存储了之后，等再进入小程序获取数据或其它的Api交互时，就可以带上放在header头中去向服务端发起请求</span>
                        uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'AuthTokens'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token<span class="token punctuation">)</span>
                        uni<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'wxCode'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">errors</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>errors<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    title<span class="token operator">:</span> <span class="token string">'微信登录失败'</span><span class="token punctuation">,</span>
                    icon<span class="token operator">:</span> <span class="token string">'none'</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p><code>AppModel</code>的接口定义，按照如下标准直接定义即可</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">HTTP</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../utils/http.js'</span>

<span class="token keyword">class</span> <span class="token class-name">AppModel</span> <span class="token keyword">extends</span> <span class="token class-name">HTTP</span> <span class="token punctuation">{</span>
    <span class="token function">login</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/user/login</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> params
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> AppModel <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>上面还应用了<code>vuex</code>的状态管理<code>this.$store.dispatch('setUserInfo', response.data)</code>，所以你还要到<code>store</code>下的<code>home</code> <code>modules模块</code>做好状态管理，主要还是<code>vuex</code>的日常操作。一般来说同步存储只要放<code>mutations</code>里面定义即可，主要还是看个人习惯吧</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>state<span class="token operator">:</span> <span class="token punctuation">{</span>
    userInfo<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
mutations<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">SET_USER_INFO</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> userInfo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    	state<span class="token punctuation">.</span>userInfo <span class="token operator">=</span> userInfo
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 缓存用户信息</span>
    <span class="token function">setUserInfo</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
        commit
    <span class="token punctuation">}</span><span class="token punctuation">,</span> userInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_USER_INFO'</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
getters<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">userInfo</span><span class="token operator">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>userInfo
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="六、静默授权"><a href="#六、静默授权" class="header-anchor">#</a> 六、静默授权</h2> <p><font color="red">授权登录</font>是一大重点，在项目刚开始开发的时候尤其要注意。小程序目前已有官方规定明确禁止新用户初次打开小程序就唤起授权登录获取用户信息的弹框，也就是说，如果你不当回事的话，即使开发完毕发布，微信官方团队也会直接咔嚓回。那个时候再改，代价就太大了</p> <p>所以呢，目前采用的是静默授权登录的方式。什么是静默授权呢，就是新用户进入你的小程序后，他可以无障碍的访问你的小程序，当他需要分享、进详情页、交互动作、点赞、购买...需要深一层次体验我们的小程序的时候，这个时候唤起授权弹窗让用户授权之后再继续下一步是合理的。</p> <p>接下来是授权登录的实现。暂时把它放在<code>个人中心</code>的头像区域吧</p> <p>1.找到<code>pages</code>--&gt;<code>mine</code>页面</p> <p>在<code>ui</code>搭建的工程中，项目默认引用<code>less</code>预处理，虽然不用安装第三方依赖，都是<code>uni-app</code>内置的，但是想要让项目正常运行，还是要安装编译时的对应工具，否则会报错</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/15/16e6e42bcc3fc7fe?w=1017&amp;h=45&amp;f=png&amp;s=51059" alt=""></p> <p>工具---&gt;插件安装</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/15/16e6e438e1a2a2f8?w=707&amp;h=230&amp;f=png&amp;s=79947" alt=""></p> <p>然后安装对应的依赖即可，再重新运行项目</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/15/16e6e44e8d839fd0?w=725&amp;h=124&amp;f=png&amp;s=22540" alt=""></p> <p>为了统一<code>静默授权</code>处理，还是抽离一个公共组件，存放在<code>components</code>-&gt;<code>common</code>-&gt;<code>userInfoBtn.vue</code>。</p> <p>要调取用户的授权登录，必须调用微信自带的<code>button</code>控件才行，包括后面的<code>分享</code>功能模块也一样。必须要用到它里面自带的<code>open-type</code>属性。</p> <p>引用微信自带的<code>button</code>当然会有很多丑陋的问题，比如样式，所以这里还是要重置下样式</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;user-info-container&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;user-info-btn&quot;</span> open<span class="token operator">-</span>type<span class="token operator">=</span><span class="token string">&quot;getUserInfo&quot;</span> @getuserinfo<span class="token operator">=</span><span class="token string">&quot;mpGetUserInfo&quot;</span> withCredentials<span class="token operator">=</span><span class="token string">&quot;true&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
    AppModel
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/models/app.js'</span>
<span class="token keyword">const</span> appModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AppModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'userInfoBtn'</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            userInfo<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">mpGetUserInfo</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//根据调用系统自带button携带的result信息判断是否有授权信息</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>errMsg <span class="token operator">!==</span> <span class="token string">'getUserInfo:ok'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    title<span class="token operator">:</span> <span class="token string">'取消授权'</span><span class="token punctuation">,</span>
                    icon<span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
                    duration<span class="token operator">:</span> <span class="token number">2000</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">//hasUserInfo为存储用户是否授权信息</span>
                uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'hasUserInfo'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            wx<span class="token punctuation">.</span><span class="token function">checkSession</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'有效'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//因为用户授权后需求获取用户授权信息，所以这里必传encryptedData、iv两个参数获取用户头像和昵称信息</span>
                    appModel<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        code<span class="token operator">:</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'wxCode'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        encryptedData<span class="token operator">:</span> result<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>encryptedData<span class="token punctuation">,</span>
                        iv<span class="token operator">:</span> result<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>iv
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'setUserInfo'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
                        uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'AuthTokens'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token<span class="token punctuation">)</span>
                        uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'hasUserInfo'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'onClickBtn'</span><span class="token punctuation">)</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>userInfo <span class="token operator">=</span> result<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>userInfo
                        uni<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'wxCode'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失效'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    uni<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'wxCode'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
                                    code<span class="token operator">:</span> res<span class="token punctuation">.</span>code
                                <span class="token punctuation">}</span>
                                appModel<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                                    code<span class="token operator">:</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'wxCode'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    encryptedData<span class="token operator">:</span> result<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>encryptedData<span class="token punctuation">,</span>
                                    iv<span class="token operator">:</span> result<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>iv
                                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                                    uni<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                                        <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                            uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'wxCode'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        <span class="token punctuation">}</span>
                                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                                    <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'setUserInfo'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
                                    uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'AuthTokens'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token<span class="token punctuation">)</span>
                                    uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'hasUserInfo'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
                                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'onClickBtn'</span><span class="token punctuation">)</span>
                                    <span class="token keyword">this</span><span class="token punctuation">.</span>userInfo <span class="token operator">=</span> result<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>userInfo
                                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'获取用户登录态失败！'</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                                title<span class="token operator">:</span> <span class="token string">'微信登录失败'</span><span class="token punctuation">,</span>
                                icon<span class="token operator">:</span> <span class="token string">'none'</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token comment">// 样式重置，这里的样式坑是必踩的</span>
<span class="token operator">&lt;</span>style lang<span class="token operator">=</span><span class="token string">&quot;less&quot;</span> scoped<span class="token operator">&gt;</span>
    <span class="token punctuation">.</span>user<span class="token operator">-</span>info<span class="token operator">-</span>btn<span class="token operator">:</span><span class="token operator">:</span>after <span class="token punctuation">{</span>
        border<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token punctuation">.</span>user<span class="token operator">-</span>info<span class="token operator">-</span>btn <span class="token punctuation">{</span>
        background<span class="token operator">-</span>color<span class="token operator">:</span> transparent<span class="token punctuation">;</span>
        line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
        padding<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
        font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br></div></div><p>2.引用上面的封装授权按钮</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>header<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;view-header_root&quot;</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;hasAuthorUrserInfo&quot;</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>image <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;avatar-img&quot;</span> <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">&quot;userInfo.avatarUrl | formatAvatarUrl&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>image <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;avatar-img2&quot;</span> <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">&quot;starUrl&quot;</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;userInfo.starId &gt; 0&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>text<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>userInfo<span class="token punctuation">.</span>userName <span class="token operator">|</span> formatUserName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;view-header_root&quot;</span> v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>userInfoBtn @onClickBtn<span class="token operator">=</span><span class="token string">&quot;onGetAuthData&quot;</span> <span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>section <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;un-auth&quot;</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span>image <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;avatar-img&quot;</span> <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">&quot;userInfo.avatarUrl | formatAvatarUrl&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span>image <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;avatar-img2&quot;</span> <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">&quot;starUrl&quot;</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;userInfo.starId &gt; 0&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>text<span class="token operator">&gt;</span>uni<span class="token operator">-</span>小程序<span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>userInfoBtn<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>header<span class="token operator">&gt;</span>

methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">onGetAuthData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token comment">//授权成功后的回调事件</span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>这里说一个小技巧，在<code>vue</code>项目中引用第三方UI框架时，肯定会涉及到修改样式的问题。由于我们在Vue文件中加入了<code>scoped</code>属性，就是为了防止页面之间的样式污染，所以你想要修改样式的话，有两种方式，第一种是新起一个<code>style</code>，不加<code>scoped</code>，然后严格遵循<code>BEM</code>命名模式修改样式，尽量避免样式污染其它页面。第二种就是引用<code>css</code>的<code>/deep/</code>，如</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>style lang<span class="token operator">=</span><span class="token string">&quot;less&quot;</span> scoped<span class="token operator">&gt;</span>
<span class="token regex">/deep/</span> <span class="token punctuation">.</span>user<span class="token operator">-</span>info<span class="token operator">-</span>btn <span class="token punctuation">{</span>
    background<span class="token operator">-</span>color<span class="token operator">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>至此静默授权的组件封装和功能都实现完毕了。还是要再强调一遍，目前开发的小程序必须采用静默授权登录的方式，否则你很大概率会被拒...</p> <p><font color="red">--- 补充说明 ---</font></p> <p>很多小伙伴可能在这里会有疑问，入口<code>App.vue</code>不是有调用过<code>appModel.login</code>这个登录口子获取<code>AuthTokens</code>了吗。为什么授权之后还要再调用一遍。原因很简单，静默授权的原则就是新用户初次进来之后，必须无障碍的浏览你的小程序，也就是说刚开始在<code>App.vue</code>页面只能获取<code>token</code>信息，因为小程序内页的接口大都是要把<code>token</code>放在<code>header</code>头去请求服务端才能拿到数据，而另外的<code>encryptedData</code>、<code>iv</code>这两个参数是只有你想获取真实的用户信息才能带上，也就是说服务端必须把这两个参数设为非必传。</p> <p>只有他想进入你的小程序的二级页面，或者首页有点赞、拍照、评论、分享...这一类你想拿到他的个人信息时，再调用这个封装的授权按钮组件让用户授权，然后再调用一遍<code>appModel.login</code>接口，再带上<code>encryptedData</code>、<code>iv</code>这两个非必传的参数，用户确认授权后，就能获取到真实的用户个人信息了。</p> <p><font color="red" size="6">请注意！！！</font></p> <p>讲真，微信授权获取用户信息这块是必不可少的，不获取用户信息那开发小程序的意义何在。但是很多产品在定性小程序的时候，就想着一进小程序就让用户授权，这种需求直接拒绝就行，不要任何拖泥带水操作。因为上不了是注定的。或者他们想着委婉点，让你在<code>tabbar</code>切换上加个授权，uni-app是没有路由的概念的，因此想要引用vue-router的钩子函数去拦截路由是行不通的，但倒不是不能实现，可以自己手写一套，但是花这么大代价有意义吗？何况所谓的静默授权的初衷，就是要让用户首次进入无障碍的使用小程序，无障碍的意义并不是说就只给看个首页，然后切换个tabbar就要授权了？！那估计也是大概率被拒的多。</p> <p>又或者他们想我不放在tabbar的切换时加入授权，我切换后在页面里面加，即从<code>首页</code>切到<code>我的</code>页面时，直接一张<code>暂无消息占位图</code>+<code>一个授权按钮</code>，只有你授权了才能看我的页面的所有内容。讲真，真的都好鸡肋，跟上面tabbar切换授权有区别吗？？？</p> <p>最后，静默授权这块怼不过产品的，就让产品多去玩玩看看大厂是怎么做的。比如小米、苏宁等等等等...祝你成功！</p> <h2 id="七、功能扩展"><a href="#七、功能扩展" class="header-anchor">#</a> 七、功能扩展</h2> <p>为了让这个项目不至于这么空壳，计划加入一些常用的功能，比如记录列表上拉加载，下拉刷新、轮播图、分享、开屏广告页、在线客服引入...</p> <p>1.上拉加载、下拉刷新</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/18/16e7c5fdc49a2256?w=320&amp;h=568&amp;f=gif&amp;s=2020180" alt=""></p> <p>入口就是在个人中心的<code>分页记录列表</code></p> <p>首先加页面路由，在<code>page</code>目录下新增一个<code>records</code>页面，然后在项目根目录下的<code>pages.json</code>挂载上，如果要新开页面的话，都要在这个目录下注册页面</p> <p>如动态图所示，这里还抽了一个<code>tab</code>选项卡的小组件。直接开箱即用就行。</p> <p>上拉加载下拉刷新在<code>uni-app</code>官网上其实是有介绍的。这里单独取出来是因因为接口都配置好了，只要替换成你项目中的服务端数据和修改下样式即可，功能是已经实现了的。代码就不全贴了，直接大致介绍下功能点吧</p> <p>上拉加载下拉刷新这功能大致分两种情况，第一种是整个页面的上拉下拉，这种实现比较简单，首先当然是要在项目根目录下的<code>pages.json</code>声明页面的可加载属性</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;path&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;pages/records/records&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;style&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>
        <span class="token string">&quot;enablePullDownRefresh&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>然后主要实现两个方法功能</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//页面上拉触底事件的处理函数</span>
<span class="token function">onReachBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">//页面下拉初始化刷新</span>
<span class="token function">onPullDownRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>是否加载完毕可以在服务端接口返回数据中对对象做处理，对应的业务在代码中都有实现好，因为接口无法正常调用，所以你要使用的话，需要替换成你自己联调的接口。</p> <p>2.联系客服</p> <p>小程序要做好的话，那细节之处肯定是必不可少的。比如客服功能的引入，实时根据用户的反馈完善或者修复问题</p> <p>小程序中不需要你额外接入在线聊天工具，当然，如果你想体验性做得好点，那可以多投入些精力做好实施聊天这一大模块。这里简单介绍一下用小程序自带的反馈聊天模块</p> <p>首先，还是得应用微信自带的<code>button按钮</code>,指定<code>open-type</code>的值为<code>contact</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>button open<span class="token operator">-</span>type<span class="token operator">=</span><span class="token string">&quot;contact&quot;</span> bindcontact<span class="token operator">=</span><span class="token string">&quot;handleContact&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;button-item-title&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在小程序中，开发者可以登录 <code>微信小程序管理后台</code>，进入菜单“客服反馈”页面获取反馈内容</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/18/16e7d60f3c38e6c3?w=1406&amp;h=691&amp;f=png&amp;s=112792" alt=""></p> <p>3.分享</p> <p>说完联系客服顺便说下分享吧，都是同样的套路，同样是应用微信自带的<code>button按钮</code>,指定<code>open-type</code>的值为<code>share</code>，然后在<code>vue</code>属性上指明你要分享的内容</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">onShareAppMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
    	title<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">分享的标题</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    	path<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/pages/mine/index?id=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>分享要带的参数<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    	imageUrl<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">分享的url</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>分享出去的携带的参数<code>id</code>提取的方式是利用小程序的生命周期函数<code>onLoad</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>onLoad(option) {
    console.log(option)
    this.id = option.id
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>4.轮播图+跳转第三方url</p> <p>同样封装成一个工具库<code>components-&gt;common-&gt;swiper.vue</code>，工具类就不多说了，引用的是系统自带的<a href="https://uniapp.dcloud.io/component/swiper?id=swiper-item" target="_blank" rel="noopener noreferrer">swiper<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>组件</p> <p>这里介绍一下跳转第三方url页吧，包括在UI搭建阶段轮播图引用其它外域链接的图片url，这两个其实算是一类问题。</p> <p><code>微信安全规范</code>里面，是明确禁止没有在<code>微信开发者后台</code>加入合法域名时，加入任何的外域链接都为非法链接，也就是说，即使是联调的服务端接口，也得把合法域名加进微信的<code>服务器域名名单</code>，包括使用微信拍照或者上传图片都必须额外加上这个合法域名名单，图片信息才能正常显示，接口才能正常引用。配置详情如下</p> <p><a href="https://mp.weixin.qq.com/wxamp/devprofile/get_profile?token=1531766382&amp;lang=zh_CN" target="_blank" rel="noopener noreferrer">配置路径<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/18/16e7d7160bf9f048?w=1446&amp;h=653&amp;f=png&amp;s=148629" alt=""></p> <p>配置完后微信开发者工具详情栏目里项目配置里会出现合法域名信息
<img src="https://user-gold-cdn.xitu.io/2019/11/18/16e7d7716990a216?w=407&amp;h=486&amp;f=png&amp;s=38594" alt="">
或者在开发环境时可以把这里勾上，但最终项目上线后还是得记得配置对应的合法域名信息</p> <p>配置好后，当你的轮播图对应的是后台的详情地址或者是微信公众号的内容时，才能够正确跳转到对应的路径中。唯一要注意的是，在本地微信开发者工具是无法测试这一功能的，最好用真机测试，否则还是要务必保证你的合法域名都在微信后台添加上了，并且本地设置也去除了合法域名的校检</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/18/16e7d805c3a3ec66?w=386&amp;h=442&amp;f=png&amp;s=43168" alt=""></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//轮播图跳转第三方url</span>
uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">bannerWebView?url=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>如上代码所示，详情页跳转第三方url，你必须得新开一个页面<code>bannerWebview</code>作为第三方路劲承载的容器，当然，别忘了路由注册。这里，你要跳转的<code>url</code>最好<code>encodeURIComponent(url)</code>，然后在<code>bannerWebview</code>文件中，利用微信自带的<code>&lt;web-view :src=&quot;url&quot;&gt;&lt;/web-view&gt;</code>，即可进行第三方页面的跳转，再次强调一遍，跳转第三方最好用真机做测试。</p> <p>这样，轮播图功能就搞定了</p> <p>扩展功能就先做这些吧，后续有时间再加一下上去...</p> <h2 id="八、开屏广告页"><a href="#八、开屏广告页" class="header-anchor">#</a> 八、开屏广告页</h2> <p>现在很多大流量的APP在首次打开时会有一个3~7S不等的小广告，当然，做得有好点你可以让他随时都能跳过。小程序里面也有广告页这样的概念，接下来就让我们来实现一下吧</p> <p>首先是广告页的入口构思，广告页放哪个位置合适呢？是放首页作为弹窗出现？？？还是作为小程序主入口出现？？？因为广告页不可能每次打开小程序都出现一次广告，那用户肯定十分反感，过度挑战用户的耐心，肯定难逃被用户卸载的下场...一般合理一点的需求就是每天的第一次打开时，加入一个3~7S不等的小广告。接下来我们来实现一下作为主入口出现的小广告。</p> <p>首先，在<code>pages.json</code>注册页面路由，这里务必要注意一点，pages数组中第一项表示应用启动页，参考：https://uniapp.dcloud.io/collocation/pages，所以要动pages数组第一项值，改为广告页</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&quot;pages&quot;: [ //pages数组中第一项表示应用启动页，参考：https://uniapp.dcloud.io/collocation/pages
    {
        &quot;path&quot;: &quot;pages/ads/index&quot;,
        &quot;style&quot;: {
            &quot;navigationBarTitleText&quot;: &quot;uni-小程序&quot;,
            &quot;navigationBarBackgroundColor&quot;: &quot;#FFFFFF&quot;
        }
    },
    ... //紧跟其它的页面
]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>广告页无非就是一个定时器，然后加一张海报或者由后台动态配置图片内容。这里提几个小点应该注意的地方，广告页肯定分打开的时机，也就是说你得判断好广告页按规定时间展示，不能每次打开都有广告页的出现。这里可以让服务端传给你一个参数。</p> <p>计数器结束后，可以立即跳转到小程序首页，并且终止定时器</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>methods: {
    uni.reLaunch({
        url: '/pages/index/index'
    })
},
onHide() {
    //清除定时器 
    this.clearTimer()
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>广告页功能的最后，打测试包或者正式包的时候一定要记得修改主入口页信息！！！否则上线后会一片空白，等广告页定时器结束之后才到主页</p> <h2 id="九、消息推送"><a href="#九、消息推送" class="header-anchor">#</a> 九、消息推送</h2> <p>消息推送是必不可少的一大模块，但是推送的这个度还是要把控好，太频繁了自然就会引起反感，那离被卸载就不远了。
消息推送的功能已经加在首页里，功能介绍的软文在另一篇博文里可以浏览。</p> <p>传送门：<a href="https://juejin.im/post/6844903949242204167" target="_blank" rel="noopener noreferrer">uni-app小程序消息推送<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="十、发布测试"><a href="#十、发布测试" class="header-anchor">#</a> 十、发布测试</h2> <p>打开微信开发者工具，在工具栏找到上传，填写版本号，发布。测试版本号可以随意填写，不过建议还是规范一点写比较好</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/18/16e7dc29da934523?w=1147&amp;h=338&amp;f=png&amp;s=55178" alt=""></p> <p>上传成功之后，可以打开<a href="https://mp.weixin.qq.com/wxamp/wacodepage/getcodepage?token=1531766382&amp;lang=zh_CN" target="_blank" rel="noopener noreferrer">微信开发者管理后台<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，现在可以看到开发者的版本</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/18/16e7dc6480c472ee?w=1728&amp;h=894&amp;f=png&amp;s=105694" alt=""></p> <p>然后指定小程序的主入口页，主要参照<code>pages.json</code>属性值<code>pages数组</code>的第一项的值</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/18/16e7dc7c27981747?w=618&amp;h=475&amp;f=png&amp;s=27998" alt=""></p> <p>然后，就可以作为体验版本提交了。</p> <h2 id="十一、发布正式"><a href="#十一、发布正式" class="header-anchor">#</a> 十一、发布正式</h2> <p>测试版本和正式版本还是有差距的。正式版本中，因为小程序发版限制在2M以内，所以有几点务必要引起注意</p> <ul><li>图片用<code>CDN</code>，不要用本地图片加载，图片内容太大</li> <li>确认涉及到这些功能点的域名信息在<code>微信开发后台管理</code>中有配置</li></ul> <p><img src="https://user-gold-cdn.xitu.io/2019/11/18/16e7dcb649d14cf5?w=383&amp;h=490&amp;f=png&amp;s=35407" alt=""></p> <ul><li>使用<a href="https://www.iconfont.cn/" target="_blank" rel="noopener noreferrer">iconFont<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>替代纯色小图标</li> <li>尽量不要引用第三方字体</li> <li>雪碧图</li> <li>... ...</li></ul> <p>发布上线。</p> <p>测试发版只要在开发者工具中直接打包上线即可，没有这么多的条条框框。但是正式版发版就不一样了，就最关键的一点，开发版和正式版的服务端域名肯定不一样吧？！所以，为了避免每次发版手动频繁修改配置接口，造成哪次不小心把测试版的发线上去，最好做个区分，把开发环境和正式环境区分开来。发正式版本的时候打正式环境的包</p> <p>主要配置呢就是在根目录新建个<code>config.js</code>文件，区分开发和正式版就是自带的<code>process.env.NODE_ENV</code>属性值</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">==</span> <span class="token string">'development'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">BASE_URL</span> <span class="token operator">=</span> <span class="token string">'192.168.1.1:8090'</span> <span class="token comment">// qe环境</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token constant">BASE_URL</span> <span class="token operator">=</span> <span class="token string">'https://www.baidu.com'</span> <span class="token comment">// 生产环境</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>然后打正式包的时候，选择<code>HBuilderX</code>开发工具工具栏<code>发行-&gt;小程序（微信）</code></p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/18/16e7dd4dc2820bad?w=639&amp;h=139&amp;f=png&amp;s=59018" alt=""></p> <p>然后检查<code>小程序名称+AppId</code>，确认无误点击发行，会再在微信开发者工具里开一个窗口，运行同样的小程序。区别只是域名地址不一样了，开发版本是本地ip，发行后的服务域名是正式的线上地址。以防万一，可以打开微信开发者工具栏的工具面板查看一下域名是否正确</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/18/16e7dd5f44ad5e26?w=433&amp;h=243&amp;f=png&amp;s=24829" alt=""></p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/18/16e7dd947082d022?w=620&amp;h=295&amp;f=png&amp;s=46810" alt=""></p> <p>确认无误后再重复测试版本发版即可</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/18/16e7dda738c710bf?w=919&amp;h=307&amp;f=png&amp;s=34994" alt=""></p> <p>至此，小程序的开发到上线就全部完成了。</p> <h2 id="十二、题外话"><a href="#十二、题外话" class="header-anchor">#</a> 十二、题外话</h2> <p>还是回归到框架的选型来讲讲，选用<code>uni-app</code>开发小程序，打包上传后，代码竟惊人的被压缩到了<code>1M以内</code>。相对比<code>mpvue</code>就重了不少，有大<code>1M多</code>。</p> <p>当时并行做的是两个小程序，基于<code>mpvue</code>和基于<code>uni-app</code>，结果是<code>mpvue</code>因为前期问题不断，导致发版被拒次数增多，最后都修复完全正式上线之后，再更新迭代，审核的时间依然长的很。但是<code>uni-app</code>做的小程序就没这个问题了，前期的几版发版比较顺利的话，后期再更新迭代，那速度真是嗖嗖的，普遍都是在一个工作日内。等信用（通过率）累计到了一定程度，会直接上微信审核的<code>白名</code>单，开启<code>半小时审核急速上线</code>的通道，真香~</p> <p>好了，基于<code>uni-app</code>的小程序开发到此结束了，喜欢的话请多赐个<font size="15" color="red">赞!!!</font>吧。</p> <h2 id="十三、github源码"><a href="#十三、github源码" class="header-anchor">#</a> 十三、Github源码</h2> <p><a href="https://github.com/zengxiaozeng/hello-uni-app" target="_blank" rel="noopener noreferrer">hello-uni-app<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="十四、基于react-redux-saga的实战项目"><a href="#十四、基于react-redux-saga的实战项目" class="header-anchor">#</a> 十四、基于React+Redux-saga的实战项目</h2> <p><a href="https://juejin.im/post/6844903986080776206" target="_blank" rel="noopener noreferrer">手把手带你搭建React16+Router+Redux-saga+Antd后台管理系统<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/6/2021, 10:03:24 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/zxz/assets/js/app.92503a3d.js" defer></script><script src="/zxz/assets/js/2.f08df1f8.js" defer></script><script src="/zxz/assets/js/41.1d1c5820.js" defer></script>
  </body>
</html>
