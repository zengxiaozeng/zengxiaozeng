<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>开发组件 | 曾小曾的前端小站</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/zxz/favicon.ico">
    <meta name="description" content=" ">
    <link rel="preload" href="/zxz/assets/css/0.styles.88aca36b.css" as="style"><link rel="preload" href="/zxz/assets/js/app.92503a3d.js" as="script"><link rel="preload" href="/zxz/assets/js/2.f08df1f8.js" as="script"><link rel="preload" href="/zxz/assets/js/34.05af0d7c.js" as="script"><link rel="prefetch" href="/zxz/assets/js/10.7a96103a.js"><link rel="prefetch" href="/zxz/assets/js/11.73c6b8eb.js"><link rel="prefetch" href="/zxz/assets/js/12.f12877c1.js"><link rel="prefetch" href="/zxz/assets/js/13.f067228c.js"><link rel="prefetch" href="/zxz/assets/js/14.7b206be0.js"><link rel="prefetch" href="/zxz/assets/js/15.b201925a.js"><link rel="prefetch" href="/zxz/assets/js/16.6d04c679.js"><link rel="prefetch" href="/zxz/assets/js/17.a9a15eaf.js"><link rel="prefetch" href="/zxz/assets/js/18.978623dd.js"><link rel="prefetch" href="/zxz/assets/js/19.93d33dda.js"><link rel="prefetch" href="/zxz/assets/js/20.5ead02f3.js"><link rel="prefetch" href="/zxz/assets/js/21.5e7348ab.js"><link rel="prefetch" href="/zxz/assets/js/22.10afa0aa.js"><link rel="prefetch" href="/zxz/assets/js/23.0e495dfc.js"><link rel="prefetch" href="/zxz/assets/js/24.dc34df21.js"><link rel="prefetch" href="/zxz/assets/js/25.a2eac0e5.js"><link rel="prefetch" href="/zxz/assets/js/26.1e4179bb.js"><link rel="prefetch" href="/zxz/assets/js/27.70c587c7.js"><link rel="prefetch" href="/zxz/assets/js/28.f1a10345.js"><link rel="prefetch" href="/zxz/assets/js/29.3b211a85.js"><link rel="prefetch" href="/zxz/assets/js/3.8507ebb1.js"><link rel="prefetch" href="/zxz/assets/js/30.634a8e99.js"><link rel="prefetch" href="/zxz/assets/js/31.0bc75df9.js"><link rel="prefetch" href="/zxz/assets/js/32.79fa5310.js"><link rel="prefetch" href="/zxz/assets/js/33.3e502a98.js"><link rel="prefetch" href="/zxz/assets/js/35.30bba2bd.js"><link rel="prefetch" href="/zxz/assets/js/36.24cda84f.js"><link rel="prefetch" href="/zxz/assets/js/37.d6f2aa9d.js"><link rel="prefetch" href="/zxz/assets/js/38.23812e8a.js"><link rel="prefetch" href="/zxz/assets/js/39.d76a3090.js"><link rel="prefetch" href="/zxz/assets/js/4.78d9e583.js"><link rel="prefetch" href="/zxz/assets/js/40.ff3d577d.js"><link rel="prefetch" href="/zxz/assets/js/41.1d1c5820.js"><link rel="prefetch" href="/zxz/assets/js/42.76c852b7.js"><link rel="prefetch" href="/zxz/assets/js/43.1b1b101a.js"><link rel="prefetch" href="/zxz/assets/js/44.dfaaad83.js"><link rel="prefetch" href="/zxz/assets/js/45.494d59fc.js"><link rel="prefetch" href="/zxz/assets/js/46.eeeec9d0.js"><link rel="prefetch" href="/zxz/assets/js/47.842028c9.js"><link rel="prefetch" href="/zxz/assets/js/48.efaff255.js"><link rel="prefetch" href="/zxz/assets/js/5.f1696d17.js"><link rel="prefetch" href="/zxz/assets/js/6.84a89b03.js"><link rel="prefetch" href="/zxz/assets/js/7.cb4465c4.js"><link rel="prefetch" href="/zxz/assets/js/8.35295575.js"><link rel="prefetch" href="/zxz/assets/js/9.6e22fe94.js">
    <link rel="stylesheet" href="/zxz/assets/css/0.styles.88aca36b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zxz/" class="home-link router-link-active"><!----> <span class="site-name">曾小曾的前端小站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zxz/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码规范" class="dropdown-title"><span class="title">代码规范</span> <span class="arrow down"></span></button> <button type="button" aria-label="代码规范" class="mobile-dropdown-title"><span class="title">代码规范</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zxz/code/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/es6/" class="nav-link">
  ECMAScript 6
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/experience/" class="nav-link">
  体验性
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="组件化" class="dropdown-title"><span class="title">组件化</span> <span class="arrow down"></span></button> <button type="button" aria-label="组件化" class="mobile-dropdown-title"><span class="title">组件化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zxz/components/directives/" class="nav-link">
  指令
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/filters/" class="nav-link">
  过滤器
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/utils/" class="nav-link">
  工具库
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/css/" class="nav-link">
  预处理语言
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/times/" class="nav-link">
  日期工具函数
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/skills/" class="nav-link">
  Vue开发技巧
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战" class="dropdown-title"><span class="title">实战</span> <span class="arrow down"></span></button> <button type="button" aria-label="实战" class="mobile-dropdown-title"><span class="title">实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zxz/projects/vue3.0/" class="nav-link">
  Vue 3.0
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/h5/" class="nav-link">
  H5支付
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/componentization/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  组件化分享
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/uniApp/" class="nav-link">
  微信小程序
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/unionpay/" class="nav-link">
  云闪付小程序
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/react/" class="nav-link">
  React+Redux-saga
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/vue2.0/" class="nav-link">
  Vue 2.0+Ts
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/jenkins/" class="nav-link">
  Jenkins自动部署
</a></li></ul></div></div><div class="nav-item"><a href="/zxz/tools/" class="nav-link">
  工具库
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zxz/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码规范" class="dropdown-title"><span class="title">代码规范</span> <span class="arrow down"></span></button> <button type="button" aria-label="代码规范" class="mobile-dropdown-title"><span class="title">代码规范</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zxz/code/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/es6/" class="nav-link">
  ECMAScript 6
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/zxz/code/experience/" class="nav-link">
  体验性
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="组件化" class="dropdown-title"><span class="title">组件化</span> <span class="arrow down"></span></button> <button type="button" aria-label="组件化" class="mobile-dropdown-title"><span class="title">组件化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zxz/components/directives/" class="nav-link">
  指令
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/filters/" class="nav-link">
  过滤器
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/utils/" class="nav-link">
  工具库
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/css/" class="nav-link">
  预处理语言
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/times/" class="nav-link">
  日期工具函数
</a></li><li class="dropdown-item"><!----> <a href="/zxz/components/skills/" class="nav-link">
  Vue开发技巧
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战" class="dropdown-title"><span class="title">实战</span> <span class="arrow down"></span></button> <button type="button" aria-label="实战" class="mobile-dropdown-title"><span class="title">实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zxz/projects/vue3.0/" class="nav-link">
  Vue 3.0
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/h5/" class="nav-link">
  H5支付
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/componentization/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  组件化分享
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/uniApp/" class="nav-link">
  微信小程序
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/unionpay/" class="nav-link">
  云闪付小程序
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/react/" class="nav-link">
  React+Redux-saga
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/vue2.0/" class="nav-link">
  Vue 2.0+Ts
</a></li><li class="dropdown-item"><!----> <a href="/zxz/projects/jenkins/" class="nav-link">
  Jenkins自动部署
</a></li></ul></div></div><div class="nav-item"><a href="/zxz/tools/" class="nav-link">
  工具库
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zxz/projects/componentization/" aria-current="page" class="active sidebar-link">开发组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zxz/projects/componentization/#组件" class="sidebar-link">组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zxz/projects/componentization/#toast插件" class="sidebar-link">Toast插件</a></li></ul></li><li class="sidebar-sub-header"><a href="/zxz/projects/componentization/#指令" class="sidebar-link">指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zxz/projects/componentization/#两位小数浮点金额指令" class="sidebar-link">两位小数浮点金额指令</a></li></ul></li><li class="sidebar-sub-header"><a href="/zxz/projects/componentization/#过滤器" class="sidebar-link">过滤器</a></li><li class="sidebar-sub-header"><a href="/zxz/projects/componentization/#表单校验" class="sidebar-link">表单校验</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zxz/projects/componentization/#表单提交" class="sidebar-link">表单提交</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="开发组件"><a href="#开发组件" class="header-anchor">#</a> 开发组件</h1> <p>在日常的开发工作中，组件化是必不可少的一部分。尤其是前后端分离以来，组件化的概念更是深入到方方面面。</p> <p>在项目开发过程中，组件化可以很好的解耦项目，显得更加直观，最主要的是可以避免一长串的面条式代码，可以为后期接手的同学减少一定的理解能力。</p> <p>为了更好的开展业务工作，本篇文章分享不局限于组件分享，还会涉及到过滤器、指令，以及表单的设计，全局组件的管理。</p> <h2 id="组件"><a href="#组件" class="header-anchor">#</a> 组件</h2> <p>定义一个组件有非常多的方式，大多数都是单页面的组件化开发，为了达到整齐、美观以及解耦，所以一般都是<code>.vue</code>的组件。因为移动端<code>ui</code>组件比较局限化，所以本篇文章以移动端的开发来展开介绍组件这一概念</p> <p>纯生态和社区活跃上来看，有赞的<a href="https://youzan.github.io/vant/#/zh-CN/" target="_blank" rel="noopener noreferrer">vant ui<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是非常值得推荐的。但是在实际开发过程中呢，<code>ui</code>框架肯定没法满足我们的日常开发需求，我们就必须得在它的基础上不断扩展符合场景的业务组件。</p> <p>既然说到了<code>vant</code>，由于移动端的关系，肯定是能精简就尽量精简为主，所以<code>vant</code>的所有组件我们并不一定会全部用上，所以最好的方式当然是按需加载，所以先记录一个按需加载引入<code>vant</code>的知识点</p> <p>怎么配置这里就暂不介绍了，这里介绍如何更好的管理按需加载的组件，如下</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  List<span class="token punctuation">,</span>
  Toast<span class="token punctuation">,</span>
  Image <span class="token keyword">as</span> VanImage<span class="token punctuation">,</span>
  Button<span class="token punctuation">,</span>
  Tab<span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vant'</span>

<span class="token keyword">const</span> components <span class="token operator">=</span> <span class="token punctuation">{</span>
  List<span class="token punctuation">,</span>
  Toast<span class="token punctuation">,</span>
  Search<span class="token punctuation">,</span>
  Button<span class="token punctuation">,</span>
  VanImage<span class="token punctuation">,</span>
  Tab<span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> BaseComponents <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">install</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>components<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>components<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> BaseComponents
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>然后直接再项目的主入口<code>main.js</code>页面里<code>import</code>即可</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// main.js
import BaseComponents from '@/components/BaseComponents.js';

Vue.use(BaseComponents);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这样对于项目中通用的<code>ui</code>组件就实行了统一管理，页面中哪里用上的话就哪里直接用就行，不用到处导入一遍，非常的便捷高效</p> <p>说完按需引入，接下来说下<code>ui</code>组件扩展吧</p> <p>比如公用的地址组件、页脚、日期选择、Loading、状态结果页、上传...这些都是在项目中复用率十分高的通用组件</p> <p>如果我们不抽离成组件的话，那每个页面中都做重复性的操作的话，那无疑是会十分的臃肿杂乱，而且四处拷贝黏贴实在是显得枯燥乏味，所以每每遇到场景一定要停下来给它抽成组件，前期花心思，后期路才会越来越顺心</p> <p>这里既然用到了组件，那就还有一个知识点，该怎么去很好的管理这些组件呢，有些页面的组件只是针对当前的页面抽离出来的业务组件，而有些是全局通用型的，如上面提到过的地址组件、页脚、日期选择、Loading、状态结果页、上传...例如统一在<code>src/components/global/...</code>下统一放置</p> <p>然后新建各个通用的组件，严格按照<code>vue</code>组件命名规范</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>---| global
-----------| CommonFooter.vue
-----------| CommonLoading.vue
-----------| CommonUpload.vue
-----------| CommonStatus.vue
-----------| CommonAddress.vue
-----------| ......
-----------| index.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>常规的通用组件就是这么引用，这里还有个<code>index.js</code>文件，这是做啥用的呢，这里做得是统一引入，就是达到前面我们所说的，偷这个合理的懒要用的文件。只要我们按照这种格式化建好对应的组件后，就可以配置好<code>index.js</code>文件，做好全局动态化引入通用组件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">const</span> requireComponent <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span>
  <span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token comment">// 查看当前目录下的文件(查找需要文件的相对路径)</span>
  <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 不查看子文件</span>
  <span class="token operator">/</span><span class="token punctuation">.</span>vue$<span class="token operator">/</span> <span class="token comment">// 匹配方式正则表达式，只查看后缀为.vue的文件</span>
<span class="token punctuation">)</span>

<span class="token comment">// 循环获取到的文件，可在循环时处理文件名</span>
requireComponent<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fileName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取组件配置(组件模板)</span>
  <span class="token keyword">const</span> componentConfig <span class="token operator">=</span> <span class="token function">requireComponent</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span>
  <span class="token comment">// 将被注册的组件名字,对获取的组件文件名进行处理</span>
  <span class="token keyword">const</span> componentName <span class="token operator">=</span> fileName
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/^\.\/_/</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\.\w+$/</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>

  <span class="token comment">// console.log(componentName, '测试组件获取测试')</span>
  <span class="token comment">// 将组件在循环中注册到全局</span>
  Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>componentName<span class="token punctuation">,</span> <span class="token comment">// 依据文件名处理好的，将要被注册到全局的组件名</span>
    componentConfig<span class="token punctuation">.</span>default <span class="token operator">||</span> componentConfig<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>从上面代码我们可以看到我们没有引入任何一个通用组件，只是定义了一个匹配方式正则表达式，对当前文件所有后缀名为.vue的文件去注册一遍</p> <p>最后我们只要在主入口<code>main.js</code>中正常引入即可</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// main.js

import './components/global'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>到这里后你在项目的任何页面中想引用通用组件的话，就再也不用到处<code>import</code>了，而是直接在<code>template</code>模板上引用即可，如</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>common<span class="token operator">-</span>footer <span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>common<span class="token operator">-</span>loading <span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>common<span class="token operator">-</span>address <span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token operator">...</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>是不是便捷了很多...</p> <p>前面分享的都是怎么去引用组件，那对于一些高并发的组件，该怎么去开发和使用呢，这里抽一个<code>toast</code>消息提示框为例来做示例吧，我们要把<code>toast</code>做成一个插件</p> <p>插件的介绍用途官方是这么介绍的</p> <ul><li>添加全局方法或者属性</li> <li>添加全局资源，如<code>directives</code>， <code>filters</code>，<code>transitions</code></li> <li>全局混入添加组件选项</li> <li>添加 Vue 实例方法，<code>Vue.prototype.$xx=..</code></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>MyPlugin.install = function (Vue, options) {
  // 1. 添加全局方法或 property
  Vue.myGlobalMethod = function () { }

  // 2. 添加全局资源
  Vue.directive('my-directive', {
    bind (el, binding, vnode, oldVnode) { }
  })

  // 3. 注入组件选项
  Vue.mixin({
    created: function () { }
  })

  // 4. 添加实例方法
  Vue.prototype.$myMethod = function (methodOptions) { }
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>安装插件</p> <ul><li>引入<code>import xx from 'xx'</code></li> <li>再，<code>Vue.use(xx)</code>，有时候可能需要加一个options</li></ul> <h3 id="toast插件"><a href="#toast插件" class="header-anchor">#</a> Toast插件</h3> <p><code>Vue.use</code>其实是执行了插件的<code>install</code>方法，且给<code>install</code>传了两个参数，一个<code>Vue构造器</code>，另一个就是可选的参数</p> <p>要写一个<code>Toast</code>插件，我们要先写好它的模板</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// Toast.vue

&lt;template&gt;
  &lt;div :class='typeClass' &gt;
    &lt;transition name='toast'&gt;
      &lt;div class=&quot;toast-content&quot; v-if='toastShow'&gt;
        &lt;span&gt;
          {{toastTxt}}
        &lt;/span&gt;
      &lt;/div&gt;
    &lt;/transition&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
export default {
  data() {
    return {
      toastShow: false,
      toastTxt: '',
      type: 'middle'
    }
  },
  computed: {
    typeClass() {
      return `my-toast ${this.type}`
    }
  }
}
&lt;/script&gt;
&lt;style lang=&quot;scss&quot; scoped&gt;
  .my-toast {
    position: fixed;
    max-width: 90%;
    width: auto;
    // top 50%
    z-index: 1000;
    left: 50%;
    transform: translate(-50%,-50%);
    &amp;.middle {
      top: 50%;
    }
    &amp;.top {
      top: 180px;
    }
    &amp;.bottom {
      bottom: 180px;
    }
    .toast-content {
      margin: 0 auto;
      background: rgba(0, 0, 0, 0.6);
      // width 600px
      padding: 10px 20px;
      min-width: 400px;
      text-align: center;
      span {
        color: rgba(255, 255, 255, 0.8);
        font-size: 26px;
        text-align: center;
        line-height: 48px;
      }
    }
  }
  .toast-enter-active, .toast-leave-active {
    transition: all linear 0.3s;
  }
  .toast-enter, .toast-leave-to {
    opacity: 0;
    // transform scale(0)
    background: rgba(0, 0, 0, 0);
  }
&lt;/style&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><p>然后我们要写一个<code>js</code>文件去加载这个模板对应的模板文件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// index.js</span>
<span class="token keyword">import</span> ToastTemplate <span class="token keyword">from</span> <span class="token string">'./Toast.vue'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Toast<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

Toast<span class="token punctuation">.</span>lock<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>

Toast<span class="token punctuation">.</span><span class="token function-variable function">install</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>Toast<span class="token punctuation">.</span>lock<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">;</span><span class="token punctuation">}</span>

  Toast<span class="token punctuation">.</span>lock<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
  

  <span class="token keyword">const</span> ToastConstructor<span class="token operator">=</span>Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>ToastTemplate<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> MyToast<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ToastConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  MyToast<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>MyToast<span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$toast<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    msg<span class="token operator">=</span><span class="token string">'加载中'</span><span class="token punctuation">,</span>
    time<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">,</span>
    type<span class="token operator">=</span><span class="token string">'middle'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    MyToast<span class="token punctuation">.</span>toastTxt<span class="token operator">=</span>msg<span class="token punctuation">;</span>
    MyToast<span class="token punctuation">.</span>toastShow<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
    MyToast<span class="token punctuation">.</span>type<span class="token operator">=</span>type<span class="token punctuation">;</span>

    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      MyToast<span class="token punctuation">.</span>toastShow<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
      Toast<span class="token punctuation">.</span>lock<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
    
    <span class="token punctuation">}</span><span class="token punctuation">,</span>time<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Toast<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>这样一个简单的<code>Toast</code>插件就完成了</p> <p>安装使用如下</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// main.js</span>

<span class="token keyword">import</span> Toast <span class="token keyword">from</span> <span class="token string">'@/components/Toast'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Toast<span class="token punctuation">)</span>

<span class="token function">Toast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>msg<span class="token operator">:</span> <span class="token string">'此处加提示信息...'</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 使用</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>总结</p> <ul><li>1、 Vue的插件是一个对象，就像Element</li> <li>2、 插件对象必须有install字段</li> <li>3、 插件对象必须有install字段</li> <li>4、 初始化插件对象需要通过Vue.use()</li></ul> <p>好了，通用性质的<code>Toast</code>插件就这么收工了，哪里要用写哪里</p> <p>组件的应用是多元化的，局部组件、全局组件、插件、mixin混入、模板自定义组件...最主要的还是要选择适应你的那一个，怎么舒服怎么来就好了，但是共同点就是，一定要组件化开发项目</p> <h2 id="指令"><a href="#指令" class="header-anchor">#</a> 指令</h2> <p>指令分局部指令和全局指令，前者是页面中的，后面是全局的指令，那应用场景呢就更不用多说了，指令能做很多很多的事情。<code>vue</code>本身内置了很多指令，都是以<code>v-*</code>格式的，如<code>v-modal</code>, <code>v-if</code>, <code>v-for</code>...</p> <p>那一般我们自己在开发中会有那些便利的指令呢</p> <p>比如输入框只允许输入数字，或者金额，同样可以用指令解决，或者是常见的点击防抖事件、按钮的点击波纹效果，这些都可以用指令来实现</p> <p>本篇文章分享一个如何取自定义开发一个指令和指令的文件管理</p> <h3 id="两位小数浮点金额指令"><a href="#两位小数浮点金额指令" class="header-anchor">#</a> 两位小数浮点金额指令</h3> <details><summary>详细代码</summary> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * input输入框两位小数
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">bind</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>
    <span class="token keyword">let</span> input <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">;</span>
    input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'compositionstart'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      vnode<span class="token punctuation">.</span>inputLocking <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'compositionend'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      vnode<span class="token punctuation">.</span>inputLocking <span class="token operator">=</span> <span class="token boolean">false</span>
      input<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>inputLocking<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">let</span> oldValue <span class="token operator">=</span> input<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
      <span class="token keyword">let</span> newValue <span class="token operator">=</span> input<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
      newValue <span class="token operator">=</span> newValue<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[^\d.]/g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      newValue <span class="token operator">=</span> newValue<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/^\./g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      newValue <span class="token operator">=</span> newValue<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">'$#$'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\./g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'$#$'</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      newValue <span class="token operator">=</span> newValue<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/^(\-)*(\d+)\.(\d\d).*$/</span><span class="token punctuation">,</span> <span class="token string">'$1$2.$3'</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> arr <span class="token operator">=</span> newValue<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
        newValue <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">'.'</span> <span class="token operator">+</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 去掉开头多余的0</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 判断是否需要更新，避免进入死循环</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>newValue <span class="token operator">!==</span> oldValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        input<span class="token punctuation">.</span>value <span class="token operator">=</span> newValue
        input<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 通知v-model更新</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// input 事件无法处理小数点后面全是零的情况 因为无法确定用户输入的0是否真的应该清除，如3.02。放在blur中去处理</span>
    input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'blur'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> oldValue <span class="token operator">=</span> input<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
      <span class="token keyword">let</span> newValue <span class="token operator">=</span> input<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        newValue <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 判断是否需要更新，避免进入死循环</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>newValue <span class="token operator">!==</span> oldValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        input<span class="token punctuation">.</span>value <span class="token operator">=</span> newValue
        input<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 通知v-model更新</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> inputFloat <span class="token keyword">from</span> <span class="token string">'./inputFloat'</span>

<span class="token keyword">const</span> <span class="token function-variable function">install</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'inputFloat'</span><span class="token punctuation">,</span> inputFloat<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>Vue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span>inputFloat <span class="token operator">=</span> inputFloat
  Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>install<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// eslint-disable-line</span>
<span class="token punctuation">}</span>

inputFloat<span class="token punctuation">.</span>install <span class="token operator">=</span> install
<span class="token keyword">export</span> <span class="token keyword">default</span> inputFloat
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>element扩展： let input = vnode.elm.children[0];</li></ul></details> <p>使用</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;el-input v-input-float /&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>是不是非常非常的方便。</p> <p>那如何的去全局管理我们自定义的各种指令呢，现在<code>src</code>下面建一个<code>directive</code>的文件夹，里面分文件存放我们的自定义的各种指令，最后在<code>directive</code>下新建一个引入的<code>js</code>文件做全局引入</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> waves <span class="token keyword">from</span> <span class="token string">'./waves'</span>
<span class="token keyword">import</span> inputNumber <span class="token keyword">from</span> <span class="token string">'./inputNumber'</span>
<span class="token keyword">import</span> inputDecimal <span class="token keyword">from</span> <span class="token string">'./inputDecimal'</span>
<span class="token keyword">import</span> debounces <span class="token keyword">from</span> <span class="token string">'./debounces'</span>
<span class="token keyword">import</span> throttles <span class="token keyword">from</span> <span class="token string">'./throttles'</span>
<span class="token keyword">import</span> Clipboard <span class="token keyword">from</span> <span class="token string">'./clipboard'</span>
<span class="token keyword">import</span> dialogDrag <span class="token keyword">from</span> <span class="token string">'./dialogDrag'</span>
<span class="token operator">...</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span>
  waves<span class="token punctuation">,</span>
  inputNumber<span class="token punctuation">,</span>
  inputDecimal<span class="token punctuation">,</span>
  debounces<span class="token punctuation">,</span>
  throttles<span class="token punctuation">,</span>
  Clipboard<span class="token punctuation">,</span>
  dialogDrag
  <span class="token operator">...</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>同样的，在主入口文件这么引用</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> directives <span class="token keyword">from</span> <span class="token string">'./directive'</span>

Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>directives<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">k</span> <span class="token operator">=&gt;</span> Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> directives<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>好了，接下来你就可以随心所欲的引用各种你自定义的指令了。</p> <h2 id="过滤器"><a href="#过滤器" class="header-anchor">#</a> 过滤器</h2> <p>过滤器能做啥用呢，过滤模板日期格式，枚举值格式化，模板空值判断，可以过滤很多你想计算的属性值。</p> <p>过滤器在项目开发中绝对是一大利器，它分局部的和全局的过滤器，局部的这里就不做过多阐述了，这里介绍一个管理全局指令的知识点</p> <p>同样的在<code>src</code>下面新建一个<code>filters</code>的文件夹，里面建一个<code>index.js</code>这样的文件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token punctuation">{</span> parseTime <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">articleStatusFilter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">status</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  		<span class="token keyword">case</span> <span class="token string">'01'</span>
  			<span class="token keyword">return</span> <span class="token string">'success'</span>
  		<span class="token keyword">case</span> <span class="token string">'02'</span>
  			<span class="token keyword">return</span> <span class="token string">'false'</span>
  		<span class="token keyword">default</span><span class="token operator">:</span>
  			<span class="token keyword">return</span> <span class="token string">'处理中...'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">formatNull</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  	<span class="token keyword">return</span> str
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  	<span class="token keyword">return</span> <span class="token string">'-'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>引用</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> filters <span class="token keyword">from</span> <span class="token string">'@/filters'</span>

Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>filters<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> filters<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>然后在页面中直接在<code>template</code>中用管道符号<code>|</code>去过滤就行了。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> time <span class="token operator">|</span> parseTime <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
	<span class="token operator">...</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="表单校验"><a href="#表单校验" class="header-anchor">#</a> 表单校验</h2> <p>请先容许我找一个示例场景</p> <p><img src="/zxz/images/projects/form.png" alt=""></p> <p>需求就是为该页面做一个表单校验</p> <p>刚拿到页面的时候，如果我不构思就开始做，用<code>Element-ui</code>的<code>form</code>表单校验来一个一个的做，一个一个的家表单规则，有些选项还有特殊的校验规则，比如手机号、身份证之类的等等，这个时候如果我们按照正常开发思维开发这个页面的话，不用怀疑千行代码就这么随随便便就出来了吧，就这样的代码，用杂又乱，压根就不好维护和管理，接手的人更是头疼不已，最主要的是容易让人看了发疯</p> <p>so...</p> <p>该怎么去处理这样的页面逻辑呢？</p> <p>拆分啊！！！</p> <p>首先这个页面我们可以把它拆分成三大块</p> <ul><li>企业信息表单 -&gt; form1.vue</li> <li>受益人表单 -&gt; form2.vue</li> <li>法人信息表单 -&gt; form3.vue</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 合并</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>form1 ref<span class="token operator">=</span><span class="token string">&quot;form1Comp&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>form2 ref<span class="token operator">=</span><span class="token string">&quot;form2Comp&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>form3 ref<span class="token operator">=</span><span class="token string">&quot;form3Comp&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>然后在各个form表单中做单独的表单验证
这里仅举一个例子来说中，其它的两个文件是一样的逻辑</p> <p>例：<code>form1.vue</code></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>el<span class="token operator">-</span>form
    ref<span class="token operator">=</span><span class="token string">&quot;form1&quot;</span>
    <span class="token operator">:</span>rules<span class="token operator">=</span><span class="token string">&quot;form1Rules&quot;</span>
    <span class="token operator">:</span>model<span class="token operator">=</span><span class="token string">&quot;form1&quot;</span>
  <span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>el<span class="token operator">-</span>form<span class="token operator">-</span>item prop<span class="token operator">=</span><span class="token string">&quot;name&quot;</span> label<span class="token operator">=</span><span class="token string">&quot;企业名称：&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>el<span class="token operator">-</span>input v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;form1.name&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>el<span class="token operator">-</span>form<span class="token operator">-</span>item prop<span class="token operator">=</span><span class="token string">&quot;shortName&quot;</span> label<span class="token operator">=</span><span class="token string">&quot;企业简称：&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>el<span class="token operator">-</span>input v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;form1.shortName&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>el<span class="token operator">-</span>form<span class="token operator">-</span>item prop<span class="token operator">=</span><span class="token string">&quot;code&quot;</span> label<span class="token operator">=</span><span class="token string">&quot;社会信用码：&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>el<span class="token operator">-</span>input v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;form1.code&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">&gt;</span>
    <span class="token operator">...</span><span class="token operator">...</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 以下是同上所有的表单校验 <span class="token operator">--</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>form<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    formData<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Object<span class="token punctuation">,</span>
      required<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      form1<span class="token operator">:</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        shortName<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        code<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token operator">...</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      form1Rules<span class="token operator">:</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'请输入名称'</span><span class="token punctuation">,</span> trigger<span class="token operator">:</span> <span class="token string">'blur'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        shortName<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'请输入简称'</span><span class="token punctuation">,</span> trigger<span class="token operator">:</span> <span class="token string">'blur'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        code<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> trigger<span class="token operator">:</span> <span class="token string">'blur'</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'请输入社会信用代码'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token operator">...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>写到这里我想大家已经可以看出区别了，跟平常的表单校验无任何差别啊？？？表示有点懵圈，那差别在哪里呢？讲真确实是没有差别，其实就是把页面拆分开三个表单组件，每个组件负责自己单独的表单验证，<font color="red" size="6">划重点!!!</font>记住，是单独的，独立的，不和其它页面做任何交互，就是简单的表单校验，设定表单规则，获取表单对象的值</p> <p>这里除了表单校验还会有表单的回显信息操作，所以会有一个<code>props</code>去接收<code>formData</code>这个大对象，这个大对象是有父节点组件传值下来的，如果监听不到回调数据的改变去渲染页面，这里可以把<code>formData</code>这个大对象加入<code>watch</code>监听，再渲染到对应的模板中即可</p> <p><font color="red" size="6">总结</font></p> <p>企业信息表单 <code>form1.vue</code>，受益人表单 -&gt; <code>form2.vue</code>，法人信息表单 -&gt; <code>form3.vue</code>只做自己页面单独的表单校验和数据回显操作，所有的表单提交操作都放到父组件页面中来</p> <h3 id="表单提交"><a href="#表单提交" class="header-anchor">#</a> 表单提交</h3> <p>重点来了，每个页面都只做单独的表单校验，那我该怎么加入表单验证呢？即当我点击页面的提交按钮，我怎么同时触发三个页面的所有校验呢？</p> <p>接到最初的父组件，我们这么改</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 合并</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>form1 ref<span class="token operator">=</span><span class="token string">&quot;form1Comp&quot;</span> <span class="token operator">:</span>form<span class="token operator">-</span>data<span class="token operator">=</span><span class="token string">&quot;parentObj&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>form2 ref<span class="token operator">=</span><span class="token string">&quot;form2Comp&quot;</span> <span class="token operator">:</span>form<span class="token operator">-</span>data<span class="token operator">=</span><span class="token string">&quot;parentObj&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>form3 ref<span class="token operator">=</span><span class="token string">&quot;form3Comp&quot;</span> <span class="token operator">:</span>form<span class="token operator">-</span>data<span class="token operator">=</span><span class="token string">&quot;parentObj&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>el<span class="token operator">-</span>button type<span class="token operator">=</span><span class="token string">&quot;primary&quot;</span> @click<span class="token operator">=</span><span class="token string">&quot;onSubmit&quot;</span><span class="token operator">&gt;</span>提交<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>button<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
	<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span>
			parentObj<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 父组件大对象，用于接收数据回显</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	methods<span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token function">getFormPromise</span><span class="token punctuation">(</span><span class="token parameter">form</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				form<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					<span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">onSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		  <span class="token comment">// 获取到组件中的form</span>
	      <span class="token keyword">const</span> form1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>form1Comp<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>form1<span class="token punctuation">;</span>
	      <span class="token keyword">const</span> form2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>form2Comp<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>form2<span class="token punctuation">;</span>
	      <span class="token keyword">const</span> form3 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>form3Comp<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>form3<span class="token punctuation">;</span>
	      
      	 <span class="token comment">// 使用Promise.all去校验结果</span>
      	 Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>form1<span class="token punctuation">,</span> form2<span class="token punctuation">,</span> form3<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>getFormPromise<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	        <span class="token keyword">const</span> validateResult <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token operator">!</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
	        <span class="token keyword">if</span> <span class="token punctuation">(</span>validateResult<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 只有所有表单都通过校验才会进入这里</span>
	          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'表单都校验通过'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	          <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
	            parentRequiredInfo<span class="token operator">:</span> <span class="token punctuation">{</span>
	              <span class="token comment">// 企业信息表单的数据，通过form1.model获取各个表单数据</span>
	              name<span class="token operator">:</span> form1<span class="token punctuation">.</span>model<span class="token punctuation">.</span>mainstay<span class="token punctuation">,</span>
	              shortName<span class="token operator">:</span> form1<span class="token punctuation">.</span>model<span class="token punctuation">.</span>merName<span class="token punctuation">,</span>
	              code<span class="token operator">:</span> form1<span class="token punctuation">.</span>model<span class="token punctuation">.</span>code<span class="token punctuation">,</span>
	              <span class="token comment">// 受益人表单的数据，通过form2.model获取各个表单数据</span>
	              beneficalName<span class="token operator">:</span> form2<span class="token punctuation">.</span>model<span class="token punctuation">.</span>beneficalName<span class="token punctuation">,</span>
	              <span class="token operator">...</span>
	              <span class="token comment">// 法人表单的数据，通过form3.model获取各个表单数据</span>
	              legalName<span class="token operator">:</span> form3<span class="token punctuation">.</span>model<span class="token punctuation">.</span>legalName<span class="token punctuation">,</span>
	              <span class="token operator">...</span>
	            <span class="token punctuation">}</span>
	          <span class="token punctuation">}</span>
	          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
	          <span class="token comment">// 到此已经可以拿到所有表单数据进行api请求</span>
	          <span class="token operator">...</span>
	        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	        	<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'信息未填写完整，请核查后重新提交!!!'</span><span class="token punctuation">)</span>
	        <span class="token punctuation">}</span>
	      <span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><p>好了，到此就完全结束了。一个大表单拆分成了三个独立的表单校验，每个独立的表单校验中互不影响，各自干好自己的分内之事，最后再由父组件去统一触发所有表单的校验工作，并且拿到对应的<code>model</code>数据做对应的<code>api</code>交互请求</p> <p>这里涉及到的点是因为表单校验是一个异步操作，所以可以用<code>Promise.all</code>去统一操作并拦截错误返回数据。</p> <p>好了，举一反三，在接下来的表单校验开发过程中，希望再也不要出现几千行的表单校验页面了...</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/6/2021, 10:03:24 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/zxz/assets/js/app.92503a3d.js" defer></script><script src="/zxz/assets/js/2.f08df1f8.js" defer></script><script src="/zxz/assets/js/34.05af0d7c.js" defer></script>
  </body>
</html>
