(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{381:function(a,s,t){"use strict";t.r(s);var e=t(40),n=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h3",{attrs:{id:"阿里app内支付"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#阿里app内支付"}},[a._v("#")]),a._v(" 阿里App内支付")]),a._v(" "),t("h3",{attrs:{id:"第一步-静默授权-获取code"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第一步-静默授权-获取code"}},[a._v("#")]),a._v(" 第一步："),t("a",{attrs:{href:"https://opendocs.alipay.com/open/284/106000",target:"_blank",rel:"noopener noreferrer"}},[a._v("静默授权，获取code"),t("OutboundLink")],1)]),a._v(" "),t("p",[a._v("不同于微信支付环境的静默授权登录，这里的静默授权真的是无感的，不会在单前页面再刷新一遍。为了全流程跑通，同样建议做好支付宝开发者平台配置，把服务端环境切到生产环境调试，同样还有前端外网可访问的带https证书的域名")]),a._v(" "),t("p",[t("img",{attrs:{src:"/zxz/images/projects/h5/alipay_01.png",alt:"阿里支付授权流程图"}})]),a._v(" "),t("ul",[t("li",[a._v("1、通过调用 "),t("code",[a._v("JSAPI")]),a._v(" "),t("code",[a._v("ap.getAuthCode")]),a._v(" 接口在当前页面唤起半屏授权浮层")]),a._v(" "),t("li",[a._v("2、用户确认授权后，接口返回 "),t("code",[a._v("auth_code")])]),a._v(" "),t("li",[a._v("3、开发者通过 "),t("code",[a._v("alipay.system.oauth.token")]),a._v(" 接口，使用 "),t("code",[a._v("auth_code")]),a._v(" 换取 "),t("code",[a._v("access_token")]),a._v(" 及用户的 "),t("code",[a._v("user_id")]),a._v("。如果需要除 "),t("code",[a._v("user_id")]),a._v(" 以外的其他信息，则使用 "),t("code",[a._v("access_token")]),a._v(" 调用 "),t("code",[a._v("alipay.user.info.share")]),a._v("获得用户信息。")])]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("// 头部引入Alipay script\n<script src=\"https://gw.alipayobjects.com/as/g/h5-lib/alipayjsapi/3.1.1/alipayjsapi.min.js\"><\/script>\n\n// 生命周期函数调用getAuthCode\nap.getAuthCode({\n  appId: that.appId,\n  scopes: ['auth_base']\n}, function (res) {\n  authCode = res.authCode // 拿到authCode\n})\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br")])]),t("h3",{attrs:{id:"第二步-换取-access-token-和-user-id"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第二步-换取-access-token-和-user-id"}},[a._v("#")]),a._v(" 第二步：换取 "),t("code",[a._v("access_token")]),a._v(" 和 "),t("code",[a._v("user_id")])]),a._v(" "),t("p",[a._v("得到 "),t("code",[a._v("auth_code")]),a._v(" 后，开发者通过 alipay.system.oauth.token(由服务端调用) 接口，使用 auth_code 换取 access_token 及用户的 user_id。auth_code 作为换取 access_token 的凭证")]),a._v(" "),t("p",[a._v("在第二步中，我们同样只需要拿"),t("code",[a._v("auth_code")]),a._v("去换取服务端返回的"),t("code",[a._v("openId")]),a._v("即可，这里的"),t("code",[a._v("access_token")]),a._v("由服务端调用")]),a._v(" "),t("h3",{attrs:{id:"第三步-获取外部订单号"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第三步-获取外部订单号"}},[a._v("#")]),a._v(" 第三步：获取外部订单号")]),a._v(" "),t("p",[a._v("要拉起"),t("code",[a._v("alipay")]),a._v("，还需要这个外部订单号，直接拿到商户号去换取对应的外部订单号即可")]),a._v(" "),t("h3",{attrs:{id:"第四步-发起支付订单"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第四步-发起支付订单"}},[a._v("#")]),a._v(" 第四步：发起支付订单")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("bankCode: this.bankCode, // 支付方式，这里是wx\nbizMchNo: this.bizMchNo, // 商户号\norderAmount: this.orderAmount, // 订单金额\noutOrderNo: this.outOrderNo, // 外部订单号\nremark: this.remarks // 备注，可选\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br")])]),t("h3",{attrs:{id:"第四步-唤起alipay支付"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第四步-唤起alipay支付"}},[a._v("#")]),a._v(" 第四步："),t("a",{attrs:{href:"http://myjsapi.alipay.com/alipayjsapi/util/pay/tradePay.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("唤起alipay支付"),t("OutboundLink")],1)]),a._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("ap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tradePay")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  tradeNO"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" payData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("aliPrepayId "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 这里的tradeNO为第四步返回的值")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[a._v("res")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("switch")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("res"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("resultCode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("...")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br")])]),t("p",[a._v("我们只要处理成功、失败、处理中、和取消这四种状态，而这里的取消状态不同于成功失败，是不需要做任何处理的！！！\n"),t("img",{attrs:{src:"/zxz/images/projects/h5/alipay_02.png",alt:"阿里支付"}})])])}),[],!1,null,null,null);s.default=n.exports}}]);